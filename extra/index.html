<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content=":Map location picker component for Android. Based on Google Maps. An alternative to Google Place Picker."><link href=https://adevintaspain.github.io/Leku/extra/ rel=canonical><meta name=author content="2019 Adevinta Spain"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="1 matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../images/leku_logo.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.2"><title>Extra - Leku</title><link rel=stylesheet href=../assets/stylesheets/application.30686662.css><link rel=stylesheet href=../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../css/site.css></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=white> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#transition-bundle tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://adevintaspain.github.io/Leku/ title=Leku class="md-header-nav__button md-logo"> <img src=../images/leku_logo_icon.png width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Leku </span> <span class=md-header-nav__topic> Extra </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/AdevintaSpain/Leku/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Leku </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://adevintaspain.github.io/Leku/ title=Leku class="md-nav__button md-logo"> <img src=../images/leku_logo_icon.png width=48 height=48> </a> Leku </label> <div class=md-nav__source> <a href=https://github.com/AdevintaSpain/Leku/ title="Go to repository" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> Leku </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title=Overview class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../getting_started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../permissions/ title=Permissions class=md-nav__link> Permissions </a> </li> <li class=md-nav__item> <a href=../localization/ title=Localization class=md-nav__link> Localization </a> </li> <li class=md-nav__item> <a href=../customization/ title=Customization class=md-nav__link> Customization </a> </li> <li class=md-nav__item> <a href=../tracking/ title=Tracking class=md-nav__link> Tracking </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Extra </label> <a href=./ title=Extra class="md-nav__link md-nav__link--active"> Extra </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#transition-bundle class=md-nav__link> Transition Bundle </a> </li> <li class=md-nav__item> <a href=#google-places class=md-nav__link> Google Places </a> </li> <li class=md-nav__item> <a href=#geocoding-api-fallback class=md-nav__link> Geocoding API Fallback </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tests class=md-nav__link> Tests </a> </li> <li class=md-nav__item> <a href=#important class=md-nav__link> Important </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sample-usage class=md-nav__link> Sample usage </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../who_made_this/ title="Who Made This" class=md-nav__link> Who Made This </a> </li> <li class=md-nav__item> <a href=../apps_using_leku/ title="Apps Using Leku" class=md-nav__link> Apps Using Leku </a> </li> <li class=md-nav__item> <a href=../contributing/ title=Contributing class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../bugs_and_feedback/ title="Bugs and Feedback" class=md-nav__link> Bugs and Feedback </a> </li> <li class=md-nav__item> <a href=../license/ title=License class=md-nav__link> License </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Table of contents</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#transition-bundle class=md-nav__link> Transition Bundle </a> </li> <li class=md-nav__item> <a href=#google-places class=md-nav__link> Google Places </a> </li> <li class=md-nav__item> <a href=#geocoding-api-fallback class=md-nav__link> Geocoding API Fallback </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tests class=md-nav__link> Tests </a> </li> <li class=md-nav__item> <a href=#important class=md-nav__link> Important </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#sample-usage class=md-nav__link> Sample usage </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/AdevintaSpain/Leku/edit/master/docs/extra.md title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a> <h1>Extra</h1> <p>If you would like to use the Geocoder presenter (MVP) used for this use case you are free to use it! GeocoderPresenter has three methods:</p> <ul> <li> <p><strong><em>getLastKnownLocation:</em></strong> Which obviously returns the last known user location as a <strong><em>Location</em></strong> object.</p> </li> <li> <p><strong><em>getFromLocationName(String query):</em></strong> Returns a <strong><em>List<code>&lt;</code>Address<code>&gt;</code></em></strong> for the text introduced.</p> </li> <li> <p><strong><em>getFromLocationName(String query, LatLng lowerLeft, LatLng upperRight):</em></strong> Returns a <strong><em>List<code>&lt;</code>Address<code>&gt;</code></em></strong> for the text and the Rectangle introduced.</p> </li> <li> <p><strong><em>getDebouncedFromLocationName(String query, int debounceTime):</em></strong> Returns a <strong><em>List<code>&lt;</code>Address<code>&gt;</code></em></strong> for the text introduced. Useful if you want to implement your own search view with auto-complete.</p> </li> <li> <p><strong><em>getDebouncedFromLocationName(String query, LatLng lowerLeft, LatLng upperRight, int debounceTime):</em></strong> Returns a <strong><em>List<code>&lt;</code>Address<code>&gt;</code></em></strong> for the text and the Rectangle introduced. Useful if you want to implement your own search view with auto-complete.</p> </li> <li> <p><strong><em>getInfoFromLocation(double latitude, double longitude):</em></strong> Returns a <strong><em>List<code>&lt;</code>Address<code>&gt;</code></em></strong> based on a latitude and a longitude.</p> </li> </ul> <p>To use it first you need to implement the GeocoderViewInterface interface in your class like:</p> <div class=codehilite><pre><span></span><span class=k>class</span> <span class=nc>LocationPickerActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>(),</span> <span class=n>GeocoderViewInterface</span> <span class=p>{</span>
</pre></div> <p>Then you need to setup the presenter:</p> <div class=codehilite><pre><span></span><span class=k>private</span> <span class=k>val</span> <span class=py>geocoderPresenter</span><span class=p>:</span> <span class=n>GeocoderPresenter</span>

<span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?)</span> <span class=p>{</span>
  <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>
  <span class=p>***</span>
  <span class=k>val</span> <span class=py>placesDataSource</span> <span class=p>=</span> <span class=n>GooglePlacesDataSource</span><span class=p>(</span><span class=n>Places</span><span class=p>.</span><span class=n>getGeoDataClient</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=k>null</span><span class=p>))</span>
  <span class=k>val</span> <span class=py>geocoder</span> <span class=p>=</span> <span class=n>Geocoder</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>Locale</span><span class=p>.</span><span class=n>getDefault</span><span class=p>())</span>
  <span class=n>apiInteractor</span> <span class=p>=</span> <span class=n>GoogleGeocoderDataSource</span><span class=p>(</span><span class=n>NetworkClient</span><span class=p>(),</span> <span class=n>AddressBuilder</span><span class=p>())</span>
  <span class=k>val</span> <span class=py>geocoderRepository</span> <span class=p>=</span> <span class=n>GeocoderRepository</span><span class=p>(</span><span class=n>AndroidGeocoderDataSource</span><span class=p>(</span><span class=n>geocoder</span><span class=p>),</span> <span class=n>apiInteractor</span><span class=o>!!</span><span class=p>)</span>
  <span class=k>val</span> <span class=py>timeZoneDataSource</span> <span class=p>=</span> <span class=n>GoogleTimeZoneDataSource</span><span class=p>(</span>
          <span class=n>GeoApiContext</span><span class=p>.</span><span class=n>Builder</span><span class=p>().</span><span class=n>apiKey</span><span class=p>(</span><span class=n>GoogleTimeZoneDataSource</span><span class=p>.</span><span class=n>getApiKey</span><span class=p>(</span><span class=k>this</span><span class=p>)).</span><span class=n>build</span><span class=p>())</span>
  <span class=n>geocoderPresenter</span> <span class=p>=</span> <span class=n>GeocoderPresenter</span><span class=p>(</span>
          <span class=n>ReactiveLocationProvider</span><span class=p>(</span><span class=n>applicationContext</span><span class=p>),</span> <span class=n>geocoderRepository</span><span class=p>,</span> <span class=n>placesDataSource</span><span class=p>,</span> <span class=n>timeZoneDataSource</span><span class=p>)</span>
  <span class=n>geocoderPresenter</span><span class=o>!!</span><span class=p>.</span><span class=n>setUI</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
  <span class=p>***</span>
<span class=p>}</span>
</pre></div> <p>And besides filling the interface methods you have to add some things to your activity/fragment lifecycle to ensure that there are no leaks.</p> <div class=codehilite><pre><span></span><span class=k>override</span> <span class=k>fun</span> <span class=nf>onStart</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onStart</span><span class=p>()</span>
    <span class=n>geocoderPresenter</span><span class=o>!!</span><span class=p>.</span><span class=n>setUI</span><span class=p>(</span><span class=k>this</span><span class=p>)</span>
<span class=p>}</span>

<span class=k>override</span> <span class=k>fun</span> <span class=nf>onStop</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>geocoderPresenter</span><span class=o>!!</span><span class=p>.</span><span class=n>stop</span><span class=p>()</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onStop</span><span class=p>()</span>
<span class=p>}</span>
</pre></div> <h4 id=transition-bundle>Transition Bundle<a class=headerlink href=#transition-bundle title="Permanent link">&para;</a></h4> <p>If you need to send and receive a param through the LocationPickerActivity you can do it. You only need to add an "Extra" param to the intent like:</p> <div class=codehilite><pre><span></span><span class=k>val</span> <span class=py>locationPickerIntent</span> <span class=p>=</span> <span class=n>LocationPickerActivity</span><span class=p>.</span><span class=n>Builder</span><span class=p>().</span><span class=n>build</span><span class=p>(</span><span class=n>applicationContext</span><span class=p>)</span>
<span class=n>locationPickerIntent</span><span class=p>.</span><span class=n>putExtra</span><span class=p>(</span><span class=s>&quot;test&quot;</span><span class=p>,</span> <span class=s>&quot;this is a test&quot;</span><span class=p>)</span>
<span class=n>startActivityForResult</span><span class=p>(</span><span class=n>locationPickerIntent</span><span class=p>,</span> <span class=n>MAP_BUTTON_REQUEST_CODE</span><span class=p>)</span>
</pre></div> <p>And parse it on onActivityResult callback:</p> <div class=codehilite><pre><span></span><span class=k>val</span> <span class=py>bundle</span> <span class=p>=</span> <span class=k>data</span><span class=p>.</span><span class=n>getBundleExtra</span><span class=p>(</span><span class=n>LocationPickerActivity</span><span class=p>.</span><span class=n>TRANSITION_BUNDLE</span><span class=p>)</span>
<span class=k>val</span> <span class=py>test</span> <span class=p>=</span> <span class=n>bundle</span><span class=p>.</span><span class=n>getString</span><span class=p>(</span><span class=s>&quot;test&quot;</span><span class=p>)</span>
</pre></div> <h4 id=google-places>Google Places<a class=headerlink href=#google-places title="Permanent link">&para;</a></h4> <p>Leku now supports Google Places queries using the search box. If you want to enable it these are the steps you need to follow:</p> <ol> <li>You need to replace your old <code>com.google.android.maps.v2.API_KEY</code> meta-data for the <code>com.google.android.geo.API_KEY</code></li> </ol> <div class=codehilite><pre><span></span><span class=c>&lt;!-- Use this if only using Maps and not Places</span>
<span class=c>    &lt;meta-data</span>
<span class=c>        android:name=&quot;com.google.android.maps.v2.API_KEY&quot;</span>
<span class=c>        android:value=&quot;@string/google_maps_key&quot;</span>
<span class=c>        /&gt;</span>
<span class=c>--&gt;</span>

    <span class=nt>&lt;meta-data</span>
        <span class=na>android:name=</span><span class=s>&quot;com.google.android.geo.API_KEY&quot;</span>
        <span class=na>android:value=</span><span class=s>&quot;@string/google_maps_key&quot;</span><span class=nt>/&gt;</span>
</pre></div> <ol> <li> <p>Enable Google Places API for Android on your <a href=https://console.developers.google.com/ >google developer console</a>.</p> </li> <li> <p>Enable it when instantiating LocationPickerActivity by adding <code>.withGooglePlacesEnabled()</code>:</p> </li> </ol> <div class=codehilite><pre><span></span><span class=k>val</span> <span class=py>locationPickerIntent</span> <span class=p>=</span> <span class=n>LocationPickerActivity</span><span class=p>.</span><span class=n>Builder</span><span class=p>()</span>
    <span class=p>**.</span><span class=n>withGooglePlacesEnabled</span><span class=p>()**</span>
    <span class=p>.</span><span class=n>build</span><span class=p>(</span><span class=n>applicationContext</span><span class=p>)</span>
</pre></div> <p>And you are good to go. :)</p> <h4 id=geocoding-api-fallback>Geocoding API Fallback<a class=headerlink href=#geocoding-api-fallback title="Permanent link">&para;</a></h4> <p>In few cases, the geocoding service from Android fails due to an issue with the NetworkLocator. The only way of fixing this is rebooting the device.</p> <p>In order to cover these cases, you can instruct Leku to use the Geocoding API. To enable it, just use the method '''withGeolocApiKey''' when invoking the LocationPicker.</p> <p>You should provide your Server Key as parameter. Keep in mind that the free tier only allows 2,500 requests per day. You can track how many times is it used in the Developer Console from Google.</p> <h5 id=tests>Tests<a class=headerlink href=#tests title="Permanent link">&para;</a></h5> <p>Note: If you need to execute the Espresso test you will need to add the Google Maps Key into the Tests AndroidManifest.xml</p> <p>Now you have all you need. :)</p> <h5 id=important>Important<a class=headerlink href=#important title="Permanent link">&para;</a></h5> <p>Searching using the "SearchView" (geocoder) will be restricted to a zone if you are with a Locale from: US, UK, France, Italy and Spain. If not, the search will return results from all the world.</p> <h2 id=sample-usage>Sample usage<a class=headerlink href=#sample-usage title="Permanent link">&para;</a></h2> <p>We provide a sample project which provides runnable code samples that demonstrate their use in Android applications. Note that you need to include your Google Play services key in the sample to be able to test it.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../tracking/ title=Tracking class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Tracking </span> </div> </a> <a href=../who_made_this/ title="Who Made This" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Who Made This </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2016 - 2019 Adevinta Spain </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/AdevintaSpain/Leku class="md-footer-social__link fa fa-github"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.c648116f.js></script> <script>app.initialize({version:"1.0.4",url:{base:".."}})</script> </body> </html>